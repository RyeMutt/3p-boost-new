From b69d65b2cb99fe8dc795554f81eee54ed2fa2b42 Mon Sep 17 00:00:00 2001
From: Nat Goodspeed <nat@lindenlab.com>
Date: Sat, 30 Mar 2024 21:36:41 -0700
Subject: [PATCH] Extract BOOST_CODECVT_DO_LENGTH_CONST

---
 .../boost/config/codecvt_do_length_const.hpp  | 35 +++++++++++++++++++
 1 file changed, 35 insertions(+)
 create mode 100644 include/boost/config/codecvt_do_length_const.hpp

diff --git a/include/boost/config/codecvt_do_length_const.hpp b/include/boost/config/codecvt_do_length_const.hpp
new file mode 100644
index 00000000..cb1dcc09
--- /dev/null
+++ b/include/boost/config/codecvt_do_length_const.hpp
@@ -0,0 +1,35 @@
+/**
+ * @file   codecvt_do_length_const.hpp
+ * @author Nat Goodspeed
+ * @date   2014-10-02
+ * @brief  Extract BOOST_CODECVT_DO_LENGTH_CONST from
+ *         boost/detail/utf8_codecvt_facet.hpp.
+ * 
+ * $LicenseInfo:firstyear=2014&license=viewerlgpl$
+ * Copyright (c) 2014, Linden Research, Inc.
+ * $/LicenseInfo$
+ */
+
+#if ! defined(BOOST_CODECVT_DO_LENGTH_CONST_HPP)
+#define BOOST_CODECVT_DO_LENGTH_CONST_HPP
+
+// This file exists to centralize logic that used to be duplicated (badly)
+// between boost/detail/utf8_codecvt_facet.hpp and
+// boost/iostreams/detail/config/codecvt.hpp. Both need to know whether the
+// first parameter to std::codecvt::do_length() should be a const or non-const
+// reference. This depends on the standard library that defines std::codecvt.
+// The answers should agree.
+#if (defined(__clang_major__) &&                                    \
+     (__clang_major__ == 5 && __clang_minor__ >= 1) ||              \
+     (__clang_major__ > 5)) ||                                      \
+    (defined(BOOST_RWSTD_VER) && BOOST_RWSTD_VER >= 0x04010300) ||  \
+    defined(__MSL_CPP__) ||                                         \
+    defined(__LIBCOMO__) ||                                         \
+    (defined(__MACH__) && defined(__INTEL_COMPILER))
+    #define BOOST_CODECVT_DO_LENGTH_CONST
+#else
+    #define BOOST_CODECVT_DO_LENGTH_CONST const
+#endif
+
+
+#endif /* ! defined(BOOST_CODECVT_DO_LENGTH_CONST_HPP) */
-- 
2.44.0

